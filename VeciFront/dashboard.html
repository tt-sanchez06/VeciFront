<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
    window.API_BASE = "https://veciback-sy9l.onrender.com";
  </script>
  <title>Dashboard - Veci</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body class="app-body">
  <div class="app-layout">
    <aside class="app-sidebar">
      <div class="sidebar-brand">
        <div class="logo">VECI</div>
      </div>
      <div id="perfil" class="sidebar-profile"></div>
      <nav class="sidebar-nav">
        <button class="nav-link active" data-view="view-solicitud" data-label-am="Nueva solicitud" data-label-vol="Solicitudes">Nueva solicitud</button>
        <button class="nav-link" data-view="view-listas" data-label-am="Mis solicitudes" data-label-vol="Mis ofertas">Mis solicitudes</button>
        <button class="nav-link" data-view="view-chat">Chat</button>
        <button class="nav-link" data-view="view-perfil" data-label-am="Editar perfil" data-label-vol="Editar perfil">Editar perfil</button>
      </nav>
      <button class="sidebar-logout" id="logoutBtn">Cerrar sesión</button>
    </aside>

    <main class="app-main" id="dashboardMain" style="display:none;">
      <header class="main-header">
        <div>
          <h1 id="mainTitle"></h1>
        </div>
      </header>

      <section class="panel-section" id="view-solicitud">
        <div class="panel-card" id="solicitudFormCard" style="display:none;">
          <form id="solicitudForm" class="stacked-form">
            <label>
              <span>Tipo de ayuda</span>
              <select name="tipo_ayuda" id="tipo_ayuda_select" required></select>
            </label>
            <label>
              <span>Descripción</span>
              <textarea name="descripcion" placeholder="En qué necesitas ayuda?" required></textarea>
            </label>
            <div class="form-actions">
              <button class="btn primary" type="submit">Publicar</button>
            </div>
          </form>
        </div>
        <div class="panel-card" id="filtrosCard" style="display:none;">
          <form id="filtrosForm" class="filter-form">
            <label>
              <span>Buscar solicitudes</span>
              <select name="tipo" id="filtro_tipo"></select>
            </label>
            <button class="btn secondary" type="submit">Filtrar</button>
          </form>
        </div>
        <div class="panel-card" id="volSolicitudesCard" style="display:none;">
          <p class="solicitudes-description" id="volSolicitudesEmpty" hidden>No hay solicitudes disponibles.</p>
          <div id="listaVoluntario"></div>
        </div>
      </section>

      <section class="panel-section" id="view-listas">
        <div class="panel-card" id="solicitudesCard">
          <div class="panel-card-header">
            <h2 id="tituloLista">Activas</h2>
          </div>
          <div id="lista"></div>
        </div>
        <div class="panel-card" id="misOfertasCard" style="display:none;">
          <div class="panel-card-header">
            <h2 id="tituloOfertas">Activas</h2>
          </div>
          <div id="misOfertas"></div>
        </div>
        <div class="panel-card" id="finalizadasCard" style="display:none;">
          <div class="panel-card-header">
            <h2>Finalizadas</h2>
          </div>
          <div id="listaFinalizadas"></div>
        </div>
      </section>

      <section class="panel-section" id="view-chat" hidden>
        <div class="panel-card chat-wrapper">
          <div class="chat-layout">
            <aside class="chat-list" id="chatList">
              <p class="muted">Selecciona una conversación</p>
            </aside>
            <div class="chat-panel">
              <div class="chat-panel-header">
                <div class="chat-partner" id="chatPartner">
                  <img src="/img/placeholder.svg" alt="Foto de perfil" id="chatPartnerAvatar" class="chat-partner-avatar" />
                  <div class="chat-partner-info">
                    <span id="chatPartnerName">Selecciona un chat</span>
                  </div>
                </div>
                <button class="btn secondary" id="chatViewProfileBtn" disabled>Ver perfil</button>
              </div>
              <div class="chat-box" id="chatPreview"></div>
              <div class="chat-typing" id="chatTypingHint"></div>
              <div class="chat-input-row">
                <input type="text" id="chatQuickInput" placeholder="Escribe un mensaje..." disabled />
                <button class="btn primary" type="button" id="chatQuickSend" disabled>Enviar</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="panel-section" id="view-perfil" hidden>
        <div class="panel-card">
          <p>Actualiza tus datos personales para que los demás usuarios te conozcan mejor.</p>
          <button class="btn primary" id="editarPerfilBtn">Editar</button>
          <form id="editProfileForm" class="stacked-form" hidden>
            <label>
              <span>Nombre</span>
              <input type="text" id="editNombre" name="nombre" required />
            </label>
            <label>
              <span>Apellido</span>
              <input type="text" id="editApellido" name="apellido" required />
            </label>
            <label>
              <span>Edad</span>
              <input type="number" id="editEdad" name="edad" min="0" required />
            </label>
            <label>
              <span>Teléfono</span>
              <input type="tel" id="editTelefono" name="telefono" inputmode="numeric" pattern="[0-9]{10}" required />
            </label>
            <label>
              <span>Documento de identidad</span>
              <input type="text" id="editDocumento" name="documento_identificacion" inputmode="numeric" pattern="[0-9]+" required />
            </label>
            <label id="editDireccionGroup" hidden>
              <span>Dirección</span>
              <input type="text" id="editDireccion" name="direccion" placeholder="Calle y número" />
            </label>
            <label>
              <span>Nueva contrasena (opcional)</span>
              <input type="password" id="editPassword" name="contrasena" />
            </label>
            <label>
              <span>Foto de perfil</span>
              <input type="file" id="editFoto" name="foto_perfil" accept="image/*" />
            </label>
            <div class="form-actions">
              <button type="button" class="btn secondary" id="editCancelBtn">Cancelar</button>
              <button type="submit" class="btn primary">Guardar cambios</button>
            </div>
          </form>
        </div>
      </section>
    </main>
  </div>

  <script src="https://veciback-sy9l.onrender.com/socket.io/socket.io.js"></script>
  <script src="js/app.js"></script>
  <script src="js/dashboard.js"></script>
</body>
</html>
